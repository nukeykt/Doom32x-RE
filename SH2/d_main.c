/* D_main.c  */
 
#include "doomdef.h" 
#include "marsonly.h"


void FUN_020377dc() {};
void FUN_020377e0() {};
void FUN_020377e4() {};
void FUN_020377e8() {};
void FUN_020377ec() {};
void FUN_020377f0() {};
void FUN_020377f4() {};
void FUN_020377f8() {};
void FUN_020377fc() {};
void FUN_02037800() {};
 
unsigned	BT_ATTACK = BT_B;
unsigned	BT_USE = BT_C;
unsigned	BT_STRAFE =	BT_C;
unsigned	BT_SPEED = BT_A;

int DAT_06001304 = 0;

int			controltype;		/* determine settings for BT_* */

int			gamevbls;			/* may not really be vbls in multiplayer */
int			vblsinframe;		/* range from 4 to 8 */

int			maxlevel;			/* highest level selectable in menu (1-25) */
jagobj_t	*backgroundpic;

int				*demo_p, *demobuffer;

/*============================================================================ */


#define WORDMASK	3

int abs (int x)
{
	if (x<0)
		return -x;
	return x;
}

/*
====================
=
= D_memset
=
====================
*/

void D_memset (void *dest, int val, int count)
{
	byte	*p;
	int		*lp;
	short	*sp;
	int v1;

	p = dest;
	v1 = 0;
	if (((int)p & 1) == 0)
	{
		v1 = (count & 1) ^ 1;
	}

	if (v1 == 0)
	{
		I_Error("D_memset:  byte access\n");
		while (1);
	}

	count >>= 1;
	
/* write 32 bytes at a time */
	lp = (int *)p;
	val = (val<<24) | (val<<16) | (val<<8) | val;
	while (count >= 16)
	{
		lp[0] = lp[1] = lp[2] = lp[3] = lp[4] = lp[5] = lp[6] = lp[7] = val;
		lp += 8;
		count -= 16;
	}
	
/* finish up */
	sp = (short *)lp;
	while (count--)
		*sp++ = val;
}


void D_memcpy (void *dest, void *src, int count)
{
	short	*d, *s;
	int v1;

	v1 = ((int)dest & 1) == 0 && (count & 1) == 0 && ((int)src & 1) == 0;

	if (v1 == 0)
	{
		I_Error("D_memcpy:  byte access\n");
		while (1);
	}

	count >>= 1;
	
	d = (short *)dest;
	s = (short *)src;
	while (count--)
		*d++ = *s++;
}


void D_strncpy (char *dest, char *src, int maxcount)
{
	byte	*p1,*p2;
	p1 = (byte *)dest;
	p2 = (byte *)src;
	while (maxcount--)
		if (! (*p1++ = *p2++) )
			return;
}

int D_strncasecmp (char *s1, char *s2, int len)
{
	while (*s1 && *s2)
	{
		if (*s1 != *s2)
			return 1;
		s1++;
		s2++;
		if (!--len)
			return 0;
	}
	if (*s1 != *s2)
		return 1;
	return 0;	
}


/*
===============
=
= M_Random
=
= Returns a 0-255 number
=
===============
*/

unsigned char rndtable[256] __attribute__((section("const"))) = {
	0,   8, 109, 220, 222, 241, 149, 107,  75, 248, 254, 140,  16,  66 ,
	74,  21, 211,  47,  80, 242, 154,  27, 205, 128, 161,  89,  77,  36 ,
	95, 110,  85,  48, 212, 140, 211, 249,  22,  79, 200,  50,  28, 188 ,
	52, 140, 202, 120,  68, 145,  62,  70, 184, 190,  91, 197, 152, 224 ,
	149, 104,  25, 178, 252, 182, 202, 182, 141, 197,   4,  81, 181, 242 ,
	145,  42,  39, 227, 156, 198, 225, 193, 219,  93, 122, 175, 249,   0 ,
	175, 143,  70, 239,  46, 246, 163,  53, 163, 109, 168, 135,   2, 235 ,
	25,  92,  20, 145, 138,  77,  69, 166,  78, 176, 173, 212, 166, 113 ,
	94, 161,  41,  50, 239,  49, 111, 164,  70,  60,   2,  37, 171,  75 ,
	136, 156,  11,  56,  42, 146, 138, 229,  73, 146,  77,  61,  98, 196 ,
	135, 106,  63, 197, 195,  86,  96, 203, 113, 101, 170, 247, 181, 113 ,
	80, 250, 108,   7, 255, 237, 129, 226,  79, 107, 112, 166, 103, 241 ,
	24, 223, 239, 120, 198,  58,  60,  82, 128,   3, 184,  66, 143, 224 ,
	145, 224,  81, 206, 163,  45,  63,  90, 168, 114,  59,  33, 159,  95 ,
	28, 139, 123,  98, 125, 196,  15,  70, 194, 253,  54,  14, 109, 226 ,
	71,  17, 161,  93, 186,  87, 244, 138,  20,  52, 123, 251,  26,  36 ,
	17,  46,  52, 231, 232,  76,  31, 221,  84,  37, 216, 165, 212, 106 ,
	197, 242,  98,  43,  39, 175, 254, 145, 190,  84, 118, 222, 187, 136 ,
	120, 163, 236, 249 
};
int	rndindex = 0;
int prndindex = 0;

int P_Random (void)
{
	prndindex = (prndindex+1)&0xff;
	return rndtable[prndindex];
}

int M_Random (void)
{
	rndindex = (rndindex+1)&0xff;
	return rndtable[rndindex];
}

void M_ClearRandom (void)
{
	rndindex = prndindex = 0;
}


void M_ClearBox (fixed_t *box)
{
	box[BOXTOP] = box[BOXRIGHT] = MININT;
	box[BOXBOTTOM] = box[BOXLEFT] = MAXINT;
}

void M_AddToBox (fixed_t *box, fixed_t x, fixed_t y)
{
	if (x<box[BOXLEFT])
		box[BOXLEFT] = x;
	else if (x>box[BOXRIGHT])
		box[BOXRIGHT] = x;
	if (y<box[BOXBOTTOM])
		box[BOXBOTTOM] = y;
	else if (y>box[BOXTOP])
		box[BOXTOP] = y;
}

int		ticsinframe;	/* how many tics since last drawer */
int		ticon;
int		frameon;
int		ticbuttons[MAXPLAYERS];
int		oldticbuttons[MAXPLAYERS];

extern	int	lasttics;

mobj_t	emptymobj;
 
/*
===============
=
= MiniLoop
=
===============
*/

/* TODO */
int MiniLoop ( void (*start)(void),  void (*stop)(void)
		,  int (*ticker)(void), void (*drawer)(void) )
{
	int exit;
	int		buttons;
	int v1;
		
/* */
/* setup (cache graphics, etc) */
/* */
	start ();
	
	ticon = 0;
	frameon = 0;
	
	M_ClearRandom ();

	gameaction = 0;
	gamevbls = 4;
	DAT_06001304 = 4;
	vblsinframe = 4;
	
	ticbuttons[0] = ticbuttons[1] = oldticbuttons[0] = oldticbuttons[1] = 0;

	do
	{
		oldticbuttons[0] = ticbuttons[0];
		oldticbuttons[1] = ticbuttons[1];
		buttons = I_ReadControls ();
		ticbuttons[consoleplayer] = buttons;

		if (demoplayback)
		{
			if (DAT_06000808)
			{
				return ga_exitdemo;
			}
			ticbuttons[consoleplayer] = buttons = *demo_p++;
			if (buttons == -1)
				return ga_6;
		}

		if (demorecording)
			*demo_p++ = buttons;

		if ((demorecording || demoplayback) && (buttons & 0x10000000) != 0)
			return ga_6;

		if (gameaction == ga_warped)
		{
			exit = ga_warped;
			break;
		}

		ticon++;
		exit = ticker ();

		while (!FUN_02036df8())
		{

		}
/* */
/* adaptive timing based on previous frame */
/* */
		vblsinframe = DAT_06000804;
		if (vblsinframe > 8)
			vblsinframe = 8;

		gamevbls = ticcount;
		drawer ();

		if (demorecording || demoplayback)
		{
			vblsinframe = 4;
			DAT_06001304 += 4;
			gamevbls = DAT_06001304;
		}

	} while (!exit);

	stop ();

	return exit;
} 

/* 
============= 
= 
= D_DoomMain 
= 
============= 
*/ 
 
void DM_main (void);

int			checkit;
skill_t		startskill = sk_medium;
int			startmap = 1;
gametype_t	starttype = gt_single;

int demo1[] __attribute__((section("const"))) = {
         0x2,           0x3,           0x0,           0x0,
         0x0,           0x0,           0x0,           0x0,
         0x0,           0x0,           0x0,           0x0,
         0x0,      0x400000,      0x400000,      0x400000,
    0x400000,      0x400000,      0x400000,      0x400000,
    0x400000,           0x0,           0x0,           0x0,
    0x800000,      0x800000,      0x800000,           0x0,
         0x0,           0x0,      0x100000,      0x100000,
    0x100000,      0x500000,      0x500000,      0x500000,
    0x500000,      0x400000,      0x400000,      0x400000,
    0x400000,      0x400000,      0x400000,      0x400000,
    0x400000,      0x400000,      0x400000,      0x400000,
         0x0,      0x400000,      0x400000,      0x400000,
  0x20400000,    0x20400000,    0x20000000,      0x800000,
    0x900000,      0x900000,      0x800000,      0x800000,
    0x800000,      0x800000,           0x0,           0x0,
  0x20100000,    0x20500000,    0x20500000,    0x20400000,
  0x20400000,    0x20400000,    0x20400000,    0x20400000,
  0x20400000,    0x20400000,    0x20400000,    0x20400000,
  0x20100000,    0x20100000,    0x20000000,    0x20000000,
  0x20000000,    0x20400000,    0x20400000,    0x20400000,
  0x20400000,    0x20400000,    0x20400000,    0x20000000,
  0x20000000,    0x20100000,    0x20100000,    0x20100000,
  0x20100000,    0x20100000,    0x20100000,    0x20000000,
  0x20800000,    0x20800000,    0x20800000,    0x20800000,
  0x20000000,    0x20000000,    0x20000000,    0x20000000,
  0x20000000,    0x20800000,    0x20800000,    0x20800000,
  0x20800000,    0x20800000,    0x20800000,    0x20100000,
  0x20100000,    0x20100000,    0x20100000,    0x20100000,
  0x20100000,    0x20100000,    0x20100000,    0x20000000,
  0x20000000,    0x20200000,    0x20200000,    0x20200000,
  0x20200000,    0x20200000,    0x20200000,    0x20200000,
  0x20600000,    0x20400000,    0x20400000,    0x20400000,
  0x20400000,    0x20400000,    0x20400000,    0x20000000,
  0x20000000,    0x20000000,    0x20000000,    0x20000000,
    0x100000,      0x500000,      0x500000,      0x402000,
      0x2000,        0x2000,           0x0,      0x400000,
    0x400000,      0x400000,      0x400000,      0x400000,
    0x500000,      0x100000,      0x100000,      0x100000,
    0x500000,      0x500000,      0x500000,      0x400000,
    0x400000,      0x400000,      0x400000,           0x0,
         0x0,     0x2000000,      0x800000,     0x2800000,
   0x2800000,           0x0,           0x0,     0x2000000,
   0x2000000,      0x800000,     0x2800000,     0x2000000,
         0x0,     0x2000000,           0x0,     0x2000000,
         0x0,     0x2000000,     0x2000000,           0x0,
   0x2000000,     0x2000000,     0x2800000,           0x0,
   0x2000000,     0x2000000,           0x0,     0x2000000,
   0x2400000,           0x0,     0x2000000,     0x2000000,
   0x2000000,     0x2000000,           0x0,     0x2000000,
         0x0,     0x2000000,           0x0,     0x2000000,
   0x2000000,           0x0,     0x2000000,           0x0,
   0x2000000,     0x2000000,      0x400000,    0x20400000,
  0x20400000,    0x20400000,    0x20400000,    0x20400000,
         0x0,           0x0,      0x100000,      0x500000,
    0x100000,      0x100000,      0x100000,      0x100000,
    0x100000,      0x100000,      0x100000,      0x100000,
    0x100000,      0x100000,      0x100000,      0x100000,
    0x100000,      0x100000,      0x100000,      0x100000,
    0x100000,      0x100000,      0x100000,      0x100000,
    0x900000,      0x800000,      0x800000,      0x800000,
    0x800000,      0x800000,      0x800000,      0x800000,
    0x800000,      0x800000,      0x800000,      0x800000,
   0x2000000,     0x2000000,           0x0,           0x0,
   0x2000000,           0x0,     0x2000000,     0x2000000,
         0x0,     0x2000000,      0x800000,     0x2800000,
   0x2800000,     0x2800000,      0x800000,      0x800000,
    0x800000,      0x800000,     0x2000000,     0x2000000,
   0x2000000,     0x2500000,      0x400000,     0x2400000,
   0x2000000,           0x0,     0x2000000,           0x0,
   0x2000000,     0x2000000,           0x0,     0x2000000,
   0x2000000,     0x2000000,     0x2000000,           0x0,
   0x2000000,     0x2000000,     0x2400000,      0x400000,
    0x400000,      0x400000,      0x400000,      0x400000,
   0x2000000,           0x0,     0x2000000,     0x2000000,
   0x2000000,     0x2000000,           0x0,     0x2100000,
    0x500000,    0x20500000,    0x20500000,    0x20500000,
  0x20500000,    0x20500000,    0x20100000,    0x20100000,
  0x20100000,    0x20100000,      0x800000,      0x800000,
    0x800000,      0x800000,      0x100000,      0x100000,
    0x100000,      0x100000,      0x100000,      0x100000,
    0x100000,      0x900000,      0x900000,      0x900000,
    0x900000,      0x900000,      0x800000,      0x800000,
    0x800000,      0x900000,      0x900000,      0x800000,
    0x800000,      0x800000,      0x100000,           0x0,
         0x0,      0x100000,      0x100000,      0x100000,
    0x100000,      0x100000,      0x100000,      0x100000,
    0x100000,      0x100000,      0x900000,      0x900000,
    0x900000,      0x900000,      0x900000,      0x900000,
    0x100000,           0x0,      0x400000,      0x400000,
    0x400000,      0x400000,      0x400000,      0x400000,
    0x400000,      0x400000,      0x400000,      0x400000,
         0x0,           0x0,           0x0,      0x400000,
    0x400000,      0x400000,      0x400000,      0x400000,
    0x400000,      0x400000,      0x400000,      0x500000,
    0x500000,      0x500000,      0x500000,      0x500000,
    0x500000,      0x500000,      0x500000,      0x500000,
    0x100000,      0x900000,      0x800000,      0x900000,
    0x800000,      0x800000,      0x800000,      0x800000,
    0x800000,      0x800000,      0x800000,      0x800000,
    0x100000,      0x400000,      0x400000,      0x400000,
    0x400000,      0x400000,      0x400000,      0x400000,
    0x400000,      0x400000,      0x400000,      0x400000,
    0x400000,      0x400000,      0x400000,      0x400000,
    0x500000,      0x500000,      0x100000,      0x100000,
    0x100000,      0x100000,      0x100000,      0x100000,
    0x100000,      0x100000,      0x100000,      0x500000,
    0x500000,      0x500000,      0x500000,      0x500000,
    0x500000,      0x100000,      0x100000,      0x100000,
    0x100000,      0x100000,      0x100000,      0x100000,
    0x100000,      0x100000,      0x100000,      0x100000,
    0x100000,      0x500000,      0x500000,      0x500000,
    0x500000,      0x500000,      0x500000,      0x500000,
    0x500000,      0x500000,      0x500000,      0x100000,
    0x100000,      0x500000,      0x500000,      0x500000,
    0x100000,      0x500000,      0x400000,      0x400000,
    0x400000,      0x100000,      0x100000,      0x100000,
    0x100000,      0x100000,      0x100000,      0x100000,
    0x900000,      0x900000,      0x900000,      0x900000,
    0x900000,      0x100000,      0x100000,      0x100000,
    0x100000,      0x500000,      0x500000,      0x500000,
    0x500000,      0x500000,      0x100000,      0x100000,
    0x100000,      0x100000,      0x100000,      0x100000,
    0x100000,      0x100000,      0x100000,      0x500000,
    0x500000,      0x500000,      0x500000,      0x500000,
    0x500000,      0x500000,      0x500000,      0x500000,
    0x500000,           0x0,           0x0,           0x0,
         0x0,           0x0,           0x0,      0x100000,
    0x400000,      0x400000,      0x400000,      0x400000,
    0x400000,     0x2000000,     0x2000000,     0x2000000,
   0x2000000,     0x2000000,           0x0,           0x0,
         0x0,           0x0,           0x0,           0x0,
         0x0,           0x0,      0x800000,      0x800000,
         0x0,     0x2000000,     0x2000000,     0x2000000,
   0x2000000,     0x2000000,     0x2000000,           0x0,
         0x0,      0x100000,      0x100000,      0x100000,
    0x100000,      0x100000,      0x100000,           0x0,
         0x0,           0x0,           0x0,           0x0,
         0x0,           0x0,           0x0,      0x400000,
         0x0,           0x0,     0x2000000,           0x0,
         0x0,           0x0,           0x0,           0x0,
         0x0,           0x0,      0x100000,      0x100000,
    0x100000,      0x100000,      0x200000,      0x200000,
    0x200000,      0x200000,      0x200000,      0x200000,
    0x200000,      0x200000,      0x200000,      0x600000,
    0x600000,      0x600000,      0x600000,      0x600000,
    0x600000,      0x600000,      0x400000,      0x400000,
    0x400000,      0x400000,      0x100000,      0x100000,
    0x100000,      0x100000,      0x100000,      0x100000,
    0x100000,      0x900000,      0x100000,      0x100000,
    0x100000,      0x100000,      0x100000,      0x100000,
    0x100000,      0x100000,      0x100000,      0x900000,
    0x800000,      0x800000,      0x800000,      0x800000,
    0x100000,      0x100000,      0x800000,      0x800000,
    0x800000,      0x100000,      0x800000,      0x800000,
    0x800000,      0x800000,           0x0,      0x100000,
    0x100000,      0x100000,      0x100000,      0x100000,
    0x100000,      0x100000,      0x100000,           0x0,
         0x0,           0x0,           0x0,           0x0,
    0x200000,      0x600000,      0x600000,      0x600000,
    0x400000,      0x400000,      0x400000,      0x400000,
    0x400000,      0x400000,      0x500000,      0x100000,
    0x100000,      0x100000,    0x20100000,    0x20900000,
  0x20900000,    0x20900000,    0x20900000,    0x20900000,
  0x20100000,    0x20100000,    0x20100000,    0x20100000,
    0x100000,      0x100000,      0x100000,      0x100000,
    0x100000,      0x900000,      0x800000,      0x800000,
    0x800000,      0x800000,      0x800000,      0x800000,
    0x800000,      0x800000,      0x800000,      0x900000,
    0x900000,      0x100000,      0x100000,      0x100000,
    0x100000,      0x100000,      0x100000,      0x100000,
    0x100000,      0x100000,      0x100000,      0x100000,
    0x100000,      0x100000,      0x100000,      0x100000,
    0x100000,      0x100000,      0x100000,      0x100000,
    0x500000,      0x500000,      0x500000,      0x500000,
    0x500000,      0x500000,      0x500000,      0x500000,
    0x500000,      0x500000,      0x100000,      0x100000,
    0x100000,      0x102000,      0x102000,        0x2000,
      0x2000,           0x0,           0x0,      0x100000,
    0x100000,      0x900000,      0x900000,      0x900000,
    0x100000,      0x500000,      0x500000,      0x500000,
    0x500000,     0x2500000,     0x2400000,     0x2400000,
   0x2000000,     0x2000000,           0x0,           0x0,
   0x2000000,     0x2000000,           0x0,      0x800000,
    0x800000,      0x900000,      0x900000,      0x900000,
    0x900000,      0x900000,      0x900000,      0x900000,
    0x900000,      0x100000,      0x100000,      0x100000,
    0x100000,      0x100000,      0x900000,      0x900000,
    0x800000,      0x800000,      0x800000,      0x800000,
    0x800000,      0x800000,      0x800000,      0x800000,
    0x800000,      0x800000,           0x0,           0x0,
    0x400000,      0x400000,           0x0,     0x2000000,
   0x2000000,     0x2000000,     0x2000000,     0x2000000,
         0x0,           0x0,           0x0,           0x0,
         0x0,           0x0,      0x900000,      0x900000,
    0x902000,      0x902000,      0x902000,      0x902000,
    0x902000,      0x902000,      0x902000,      0x902000,
    0x902000,           0x0,      0x400000,      0x400000,
    0x400000,      0x400000,      0x400000,      0x400000,
    0x400000,      0x400000,      0x400000,      0x400000,
    0x400000,      0x400000,      0x400000,      0x400000,
    0x400000,      0x400000,     0x2000000,     0x2000000,
   0x2000000,     0x2000000,           0x0,           0x0,
    0x400000,      0x400000,           0x0,           0x0,
         0x0,     0x2000000,     0x2000000,     0x2000000,
   0x2000000,     0x2000000,     0x2000000,     0x2000000,
   0x2000000,           0x0,     0x2000000,     0x2000000,
    0x400000,      0x400000,     0x2000000,     0x2000000,
    0x800000,      0x800000,      0x800000,      0x800000,
    0x800000,      0x800000,      0x800000,      0x800000,
   0x2000000,     0x2000000,     0x2000000,     0x2000000,
   0x2000000,     0x2800000,     0x2800000,           0x0,
         0x0,      0x100000,    0x20100000,    0x20100000,
  0x20900000,    0x20900000,    0x20900000,    0x20900000,
  0x20900000,    0x20900000,    0x20100000,    0x20100000,
  0x20100000,    0x20500000,    0x20500000,    0x20500000,
  0x20100000,    0x20100000,    0x20100000,    0x20500000,
  0x20500000,    0x20500000,    0x20100000,    0x20100000,
  0x20100000,    0x20100000,    0x20100000,    0x20100000,
  0x20100000,    0x20100000,    0x20100000,    0x20100000,
  0x20100000,    0x20100000,    0x20100000,    0x20100000,
  0x20100000,    0x20100000,    0x20100000,    0x20100000,
  0x20100000,    0x20100000,    0x20000000,    0x20000000,
  0x20800000,      0x800000,      0x900000,      0x900000,
    0x100000,      0x100000,        0x2000,        0x2000,
      0x2000,        0x2000,           0x0,           0x0,
    0x400000,      0x400000,      0x400000,      0x500000,
    0x100000,      0x100000,      0x100000,      0x100000,
   0x2000000,     0x2000000,     0x2000000,     0x2000000,
   0x2400000,     0x2400000,     0x2400000,      0x400000,
         0x0,     0x2000000,     0x2000000,     0x2000000,
   0x2000000,     0x2000000,     0x2000000,     0x2800000,
   0x2800000,     0x2800000,     0x2800000,     0x2800000,
   0x2800000,     0x2800000,           0x0,           0x0,
         0x0,           0x0,      0x100000,      0x100000,
    0x100000,      0x100000,    0x20100000,    0x20000000,
         0x0,      0x800000,     0x2800000,     0x2800000,
   0x2800000,     0x2000000,           0x0,           0x0,
         0x0,      0x400000,      0x400000,      0x400000,
    0x400000,           0x0,      0x100000,      0x100000,
    0x100000,      0x500000,      0x400000,      0x400000,
    0x400000,      0x400000,      0x400000,      0x400000,
    0x400000,      0x100000,      0x800000,     0x2800000,
   0x2800000,     0x2000000,     0x2000000,           0x0,
         0x0,           0x0,           0x0,           0x0,
         0x0,           0x0,           0x0,      0x800000,
    0x900000,      0x900000,      0x100000,      0x100000,
    0x100000,      0x100000,      0x100000,      0x100000,
    0x100000,      0x100000,      0x100000,     0x2100000,
   0x2100000,     0x2100000,     0x2100000,     0x2100000,
   0x2100000,     0x2100000,           0x0,           0x0,
         0x0,           0x0,           0x0,      0x100000,
    0x500000,      0x400000,      0x400000,      0x400000,
    0x400000,     0x2400000,     0x2400000,     0x2000000,
   0x2000000,     0x2000000,     0x2000000,     0x2000000,
   0x2800000,     0x2800000,      0x800000,      0x800000,
   0x2800000,     0x2800000,     0x2000000,     0x2000000,
   0x2000000,     0x2000000,     0x2000000,     0x2000000,
   0x2000000,     0x2000000,     0x2000000,     0x2100000,
   0x2100000,     0x2100000,     0x2100000,      0x100000,
    0x100000,      0x100000,      0x900000,      0x800000,
    0x800000,      0x800000,      0x800000,      0x800000,
    0x100000,      0x100000,      0x100000,      0x500000,
    0x500000,      0x500000,      0x500000,      0x500000,
    0x500000,      0x100000,      0x900000,      0x800000,
    0x800000,      0x800000,      0x800000,      0x800000,
    0x800000,      0x800000,      0x800000,      0x800000,
    0x900000,      0x100000,      0x100000,      0x100000,
    0x100000,      0x100000,      0x100000,      0x100000,
    0x100000,      0x100000,      0x100000,      0x100000,
    0x100000,      0x100000,      0x100000,      0x100000,
    0x100000,      0x100000,      0x100000,      0x100000,
    0x100000,      0x100000,      0x100000,      0x100000,
    0x900000,      0x900000,      0x900000,      0x900000,
    0x100000,      0x100000,      0x100000,      0x100000,
    0x100000,      0x100000,      0x100000,      0x100000,
    0x100000,      0x100000,      0x100000,      0x100000,
    0x100000,      0x100000,      0x100000,      0x100000,
    0x100000,      0x100000,      0x100000,      0x100000,
    0x100000,      0x100000,      0x100000,      0x100000,
    0x100000,      0x100000,      0x100000,      0x100000,
    0x100000,      0x100000,      0x100000,      0x100000,
    0x900000,      0x800000,      0x800000,      0x800000,
    0x800000,      0x800000,      0x800000,      0x800000,
    0x800000,      0x800000,      0x800000,      0x800000,
    0x800000,      0x800000,           0x0,           0x0,
   0x2000000,     0x2400000,      0x400000,      0x400000,
    0x400000,      0x400000,      0x400000,      0x400000,
         0x0,           0x0,           0x0,           0x0,
         0x0,           0x0,           0x0,           0x0,
         0x0,           0x0,           0x0,           0x0,
         0x0,           0x0,           0x0,           0x0,
         0x0,           0x0,           0x0,           0x0,
         0x0,           0x0,           0x0,           0x0,
         0x0,           0x0,           0x0,           0x0,
         0x0,           0x0,           0x0,           0x0,
         0x0,           0x0,           0x0,           0x0,
         0x0,           0x0,           0x0,           0x0,
         0x0,           0x0,           0x0,           0x0,
         0x0,           0x0,           0x0,           0x0,
         0x0,           0x0,           0x0,           0x0,
         0x0,           0x0,           0x0,           0x0,
         0x0,           0x0,           0x0,           0x0,
         0x0,           0x0,           0x0,           0x0,
         -1,-1,-1,-1
};

/* TODO */
void D_DoomMain (void) 
{    
	unsigned short v1;
	unsigned short v2;
D_printf ("C_Init\n");
	C_Init ();		/* set up object list / etc	  */
D_printf ("Z_Init\n");
	Z_Init (); 
D_printf ("W_Init\n");
	W_Init ();
D_printf ("I_Init\n");
	I_Init (); 
D_printf ("R_Init\n");
	R_Init (); 
D_printf ("P_Init\n");
	P_Init (); 
D_printf ("S_Init\n");
	S_Init ();

/*========================================================================== */

D_printf ("DM_Main\n");

	DAT_06000810 = 1;

	v2 = FUN_020366ac(&v1);

	while (v2 != 0xdeaf)
	{
		Delay(50);
		v2 = FUN_020366ac(&v1);
	}

	FUN_0204cfe4();
	FUN_02037604();

	while (!DAT_06000808)
	{
		G_PlayDemoPtr(demo1);
	}

	v2 = FUN_020366ac(&v1);

	while (v2 != 0xd559)
	{
		Delay(50);
		v2 = FUN_020366ac(&v1);
	}
	startmap = v2 & 255;

	if (startmap != 1)
		cheated = true;

	startskill = (v2 >> 8) & 15;

    if (v2 & 0x8000)
        DAT_06000810 = 1;
    else
        DAT_06000810 = 0;

	G_InitNew(startskill, startmap, gt_single);

	G_RunGame();
} 
 
